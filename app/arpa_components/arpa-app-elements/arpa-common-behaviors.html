<link rel="import" href="../../bower_components/polymer/polymer.html">

<script>
    (function () {
        'use strict';
        /**
         * @polymerBehavior Polymer.ArpaMessages
         */
        Polymer.ArpaMessages = {
            _setMessage: function (_elment, _msg) {
                if (typeof _msg === "object" && (_msg.code || _msg.message)) {
                    _elment.text = (_msg.code && _msg.message) ? _msg.code + ": " + _msg.message : _msg.code ? _msg.code : _msg.message;
                } else {
                    _elment.text = _msg;
                }
            },
            showInfoMessage: function (_msg) {
                if (Arpa.defaultToast) {
                    this._setMessage(Arpa.defaultToast, _msg);
                    Arpa.defaultToast.classList.remove("success-message", "info-message");
                    Arpa.defaultToast.classList.add("info-message");
                    Arpa.defaultToast.open();
                }
            },
            showSuccessMessage: function (_msg) {
                if (Arpa.defaultToast) {
                    this._setMessage(Arpa.defaultToast, _msg);
                    Arpa.defaultToast.classList.remove("success-message", "info-message");
                    Arpa.defaultToast.classList.add("success-message");
                    Arpa.defaultToast.open();
                }
            },
            showErrorMessage: function (_msg) {
                if (Arpa.persistentToast) {
                    this._setMessage(Arpa.persistentToast, _msg);
                    Arpa.persistentToast.classList.remove("error-message", "info-message");
                    Arpa.persistentToast.classList.add("error-message");
                    Arpa.persistentToast.open();
                }
            }
        };

        /**
         * @polymerBehavior Polymer.ArpaCore
         */
        Polymer.ArpaCoreImpl = {
            properties: {
                user: {
                    type: Object,
                    value: {},
                    notify: true
                },
                accessToken: {
                    type: String,
                    value: null,
                    notify: true
                },
                signedIn: {
                    type: Boolean,
                    value: false,
                    notify: true
                },
                online: {
                    type: Boolean,
                    value: false,
                    notify: true
                },
                language: {
                    type: String,
                    value: "es",
                    notify: true
                }
            },

            attached: function () {
                if (this.loadResources) {
                    this.loadResources(this.resolveUrl('locales.json'));
                }
            }
        };

        Polymer.ArpaCore = [Polymer.AppLocalizeBehavior, Polymer.ArpaCoreImpl];

        /**
         * @polymerBehavior Polymer.ArpaForms
         */
        Polymer.ArpaForms = {
            cloneObject: function (_object) {
                return JSON.parse(JSON.stringify(_object));
            },
            toEditableObject: function (_object) {
                var clonedObj = this.cloneObject(_object);
                delete clonedObj["$id"];
                return clonedObj;
            },
            performFieldsValidation: function (_fieldIds) {
                var valid = true;
                for (var i = 0; i < _fieldIds.length; i++) {
                    this.$[_fieldIds[i]].validate();
                    if (this.$[_fieldIds[i]].invalid) {
                        valid = false;
                    }
                }
                return valid;
            },
            clearFieldsValidation: function (_fieldIds, _clearFields) {
                for (var i = 0; i < _fieldIds.length; i++) {
                    if (this.$[_fieldIds[i]]) {
                        if (_clearFields && this.$[_fieldIds[i]].clear) {
                            this.$[_fieldIds[i]].clear();
                        }
                        this.$[_fieldIds[i]].invalid = false;
                    } else {
                        console.log("Field not found: " + _fieldIds[i]);
                    }
                }
            },
            setPropertiesFromEntity: function (_objectName, _propertyNames) {
                var jsonObject = this.get(_objectName);
                for (var i = 0; i < _propertyNames.length; i++) {
                    var propertyName = _propertyNames[i];
                    var propertyValue = jsonObject[propertyName];
//                    if (typeof propertyValue !== 'undefined')
                    {
                        var propertyPath = _objectName + "." + propertyName;
                        console.log("propertyPath: ", propertyPath, "propertyValue: ", propertyValue)
                        this.set(propertyPath, propertyValue);
                    }
                }
            },
            pushPropertiesToEntity: function (_objectName, _propertyNames) {
                var jsonObject = this.get(_objectName);
                for (var i = 0; i < _propertyNames.length; i++) {
                    var propertyName = _propertyNames[i];
                    var propertyPath = _objectName + "." + propertyName;
                    var propertyValue = this.get(propertyPath);
                    if (typeof propertyValue !== 'undefined') {
                        jsonObject[propertyName] = propertyValue;
                    }
                }
            }
        };

        /**
         * @polymerBehavior Polymer.ArpaCollections
         */
        Polymer.ArpaCollections = {
            queryResultsToArrayObject: function (_queryResult) {
                var resultArray = [];
                if (_queryResult) {
                    for (var key in _queryResult) {
                        if (_queryResult.hasOwnProperty(key)) {
                            if (typeof _queryResult[key] === "object") {
                                var jsonObject = _queryResult[key];
                                jsonObject["$id"] = key;
                                resultArray.push(jsonObject);
                            }
                        }
                    }
                }
                return resultArray;
            }
        };
    })();
</script>
